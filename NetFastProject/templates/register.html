{% load static %}
<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NetFast - Registrasi</title>

    <!-- Bootstrap -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;800&family=Raleway:ital,wght@1,500&display=swap" rel="stylesheet">

    <style>
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(120deg, #b8c6db 0%, #f5f7fa 100%);
            position: relative;
            overflow-y: auto;
        }

        .bg-shape {
            position: fixed;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.6;
            z-index: 0;
        }

        .shape1 { width: 300px; height: 300px; background: #667eea; top: -80px; left: -60px; }
        .shape2 { width: 400px; height: 400px; background: #764ba2; bottom: -100px; right: -100px; }

        .register-box {
            background: #fff;
            border-radius: 25px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.1);
            max-width: 700px;
            width: 95%;
            padding: 40px 45px;
            margin: 80px auto;
            position: relative;
            z-index: 10;
        }

        .register-header {
            text-align: center;
            margin-bottom: 15px;
        }

        .step-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
        }

        .step {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: #d1c4e9;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            transition: 0.3s;
        }

        .step.active {
            background: #764ba2;
            box-shadow: 0 0 10px rgba(118,75,162,0.4);
        }

        .form-control, .form-select {
            border-radius: 30px;
            padding: 12px 18px;
            border: 1.5px solid #d1c4e9;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: #764ba2;
            box-shadow: 0 0 8px rgba(118,75,162,0.3);
        }

        .btn-register {
            border-radius: 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: #fff;
            font-weight: 600;
            padding: 12px;
            width: 100%;
            transition: 0.3s;
        }

        .btn-register:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(0,0,0,0.2);
        }

        #alertMessage {
            display: none;
        }

        /* ===================== RESPONSIVE FIX ===================== */

        @media(max-width: 768px) {
            .register-box {
                width: 98%;
                padding: 30px 25px;
                margin: 40px auto;
            }

            .register-header h2 {
                font-size: 1.8rem;
            }

            .register-header p {
                font-size: 0.9rem;
            }

            .step-bar {
                margin-bottom: 20px;
            }

            .step {
                width: 30px;
                height: 30px;
                font-size: 0.9rem;
            }

            .form-control, .form-select {
                padding: 10px 15px;
                font-size: 0.9rem;
            }

            .btn-register {
                padding: 10px;
                font-size: 0.95rem;
            }

            .text-center.mt-3 {
                font-size: 0.8rem;
            }

            .shape1 {
                width: 200px;
                height: 200px;
                top: -40px;
                left: -20px;
            }

            .shape2 {
                width: 250px;
                height: 250px;
                bottom: -60px;
                right: -50px;
            }
        }

        @media(max-width: 480px) {
            .register-box {
                width: 95%;
                padding: 25px 20px;
                margin: 20px auto;
                border-radius: 15px;
            }

            .register-header h2 {
                font-size: 1.6rem;
            }

            .register-header p {
                font-size: 0.85rem;
            }

            .step-bar {
                margin-bottom: 15px;
            }

            .step {
                width: 25px;
                height: 25px;
                font-size: 0.8rem;
            }

            .form-control, .form-select {
                padding: 8px 12px;
                font-size: 0.85rem;
            }

            .btn-register {
                padding: 8px;
                font-size: 0.9rem;
            }

            .text-center.mt-3 {
                font-size: 0.8rem;
            }

            .shape1 {
                width: 150px;
                height: 150px;
                top: -30px;
                left: -15px;
            }

            .shape2 {
                width: 180px;
                height: 180px;
                bottom: -40px;
                right: -30px;
            }
        }

        @media(max-width: 360px) {
            .register-box {
                width: 98%;
                padding: 20px 15px;
                margin: 10px auto;
                border-radius: 10px;
            }

            .register-header h2 {
                font-size: 1.4rem;
            }

            .register-header p {
                font-size: 0.8rem;
            }

            .step-bar {
                margin-bottom: 10px;
            }

            .step {
                width: 20px;
                height: 20px;
                font-size: 0.7rem;
            }

            .form-control, .form-select {
                padding: 6px 10px;
                font-size: 0.8rem;
            }

            .btn-register {
                padding: 6px;
                font-size: 0.85rem;
            }

            .text-center.mt-3 {
                font-size: 0.75rem;
            }

            .shape1 {
                width: 120px;
                height: 120px;
                top: -20px;
                left: -10px;
            }

            .shape2 {
                width: 140px;
                height: 140px;
                bottom: -30px;
                right: -20px;
            }
        }
    </style>
</head>

<body>

    <div class="shape1 bg-shape"></div>
    <div class="shape2 bg-shape"></div>

    <div class="register-box">

        <div class="register-header">
            <h2>NetFast</h2>
            <p>Daftar Akun Pelanggan Baru</p>
        </div>

        <!-- STEP BAR 1-8 -->
        <div class="step-bar" id="stepBar">
            <div class="step" id="s1">1</div>
        </div>

        <div id="alertMessage" class="alert"></div>

        <form id="registerForm">

            <div class="row g-3">

                <div class="col-md-6">
                    <label class="form-label">Nama Lengkap</label>
                    <input type="text" id="nama_lengkap" class="form-control">
                </div>

                <div class="col-md-6">
                    <label class="form-label">Email</label>
                    <input type="email" id="email" class="form-control">
                </div>

                <div class="col-md-6">
                    <label class="form-label">Password</label>
                    <input type="password" id="password" minlength="8" class="form-control">
                </div>

                <div class="col-md-6">
                    <label class="form-label">Konfirmasi Password</label>
                    <input type="password" id="confirm_password" class="form-control">
                </div>

                <div class="col-md-6">
                    <label class="form-label">Area Layanan</label>
                    <select id="area_layanan" class="form-select">
                        <option value="">-- Pilih Area --</option>
                        <option value="Jakarta Selatan">Jakarta Selatan (12110)</option>
                        <option value="Surabaya Pusat">Surabaya Pusat (60171)</option>
                        <option value="Bandung Kota">Bandung Kota (40111)</option>
                    </select>
                </div>

                <div class="col-md-6">
                    <label class="form-label">Nomor Telepon</label>
                    <input type="tel" id="no_telepon" class="form-control">
                </div>

                <div class="col-12">
                    <label class="form-label">Alamat Detail</label>
                    <textarea id="alamat_detail" rows="3" class="form-control"></textarea>
                </div>

            </div>

            <button type="submit" class="btn-register mt-4">Daftar Sekarang</button>

            <div class="text-center mt-3">
                Sudah punya akun? <a href="{% url 'login_page' %}">Login di sini</a>
            </div>

        </form>
    </div>

    <script>
        function getCookie(name) {
            let cookieValue = null;
            const cookies = document.cookie.split(';');

            for (let cookie of cookies) {
                cookie = cookie.trim();
                if (cookie.startsWith(name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }

            return cookieValue;
        }

        function showAlert(msg, type = "danger") {
            const a = document.getElementById("alertMessage");
            a.className = `alert alert-${type}`;
            a.style.display = "block";
            a.textContent = msg;
            setTimeout(() => a.style.display = "none", 5000);
        }

        function updateStepBar() {
            const fields = [
                "nama_lengkap", "email", "password", "confirm_password",
                "area_layanan", "no_telepon", "alamat_detail"
            ];

            fields.forEach((id, index) => {
                const step = document.getElementById("s" + (index + 1));
                const value = document.getElementById(id).value.trim();

                if (value.length > 0) step.classList.add("active");
                else step.classList.remove("active");
            });

            document.getElementById("s8").classList.add("active");
        }

        document.querySelectorAll("input, textarea, select").forEach(el => {
            el.addEventListener("input", updateStepBar);
        });

        document.getElementById("registerForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            const pass = document.getElementById("password").value;
            const conf = document.getElementById("confirm_password").value;

            if (pass !== conf)
                return showAlert("⚠ Password dan konfirmasi tidak cocok!");

            const data = {
                nama_lengkap: document.getElementById("nama_lengkap").value,
                email: document.getElementById("email").value,
                password: pass,
                area_layanan: document.getElementById("area_layanan").value,
                alamat_pemasangan: document.getElementById("alamat_detail").value,
                no_telepon: document.getElementById("no_telepon").value
            };

            try {
                const res = await fetch("/register/", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "X-CSRFToken": getCookie("csrftoken")
                    },
                    body: JSON.stringify(data)
                });

                const json = await res.json();

                if (!res.ok)
                    return showAlert("❌ Registrasi gagal: " + (json.error || "Terjadi kesalahan."));

                showAlert("✔ Registrasi berhasil! Mengalihkan ke halaman login...", "success");

                setTimeout(() => {
                    window.location.href = "{% url 'login_page' %}";
                }, 2000);

            } catch (err) {
                showAlert("❌ Gagal terhubung ke server!");
            }
        });
    </script>

</body>
</html>
